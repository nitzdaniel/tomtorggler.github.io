---
layout: post
title: "Lync SDN API and Cisco WLC"
date: 2016-06-26 19:39:00 +0200
comments: true
published: true
excerpt_separator: <!-- more -->
tags: ["Lync", "en"]
redirect_from: ["/post/Lync-SDN-API-and-Cisco-WLC", "/post/lync-sdn-api-and-cisco-wlc"]
---
<!-- more -->
{% include imported_disclaimer.html %}
<p>Some days ago I had the chance to test Cisco’s Wireless LAN Controllers with the Lync Software Defined Networking (SDN) API. For those who don’t know what SDN API is, a quick overview: You can basically think of the SDN API as a little add-on, that can be installed on Lync Front End Servers, and that allows Lync to “let the network know” what’s going on from it’s perspective. The SDN API is made up of two components, the Lync Dialog Listener (LDL) and the Lync SDN Manager (LSM). The LDL component is installed on each Front End Server, and sends information to the LSM. The LSM forwards information to a so called SDN Controller, which, in our case, is the Cisco WLC.</p> <p>More information and the API documentation is available on the MSDN: <a title="https://msdn.microsoft.com/en-us/library/office/dn387071.aspx" href="https://msdn.microsoft.com/en-us/library/office/dn387071.aspx">https://msdn.microsoft.com/en-us/library/office/dn387071.aspx</a></p> <p><a href="/assets/image_726.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_724.png" width="244" height="50"></a></p> <h1>The WLC Side </h1> <p>The SDN Controller has to accept and process information coming from the LSM, Cisco has built this&nbsp; functionality into it’s Wireless LAN Controller software from 7.6. We used 8.2 in this example. First we need to define a port, protocol, and enable the “Lync Server” option globally. This can be done using the “Lync Server” option in the “Wireless” tab:</p> <p><a href="/assets/image_727.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_725.png" width="244" height="200"></a></p> <p>Now that the WLC listens for information, we’ll have to tell it, what to do with. Using the “WLANs” tab, we created a new SSID, enabled “Lync Server” and selected the appropriate QoS policy for each type of traffic:</p> <p><a href="/assets/image_728.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_726.png" width="244" height="127"></a></p> <p>A quick excerpt from “show wlan” shows the QoS settings:&nbsp;&nbsp; </p> <p><code>Local Policy<br>----------------<br>Priority&nbsp; Policy Name<br>--------&nbsp; ---------------</p> <p>Lync State ...................................... Enabled<br>Audio QoS Policy................................. Platinum<br>Video QoS Policy................................. Gold<br>App-Share QoS Policy............................. Silver<br>File Transfer QoS Policy......................... Bronze</code></p> <h1></h1> <h1>The Lync Side</h1> <p>Meanwhile, we’ve installed the Lync SDN Manager on a dedicated server, as it’s not recommended to run it on the Front Ends (and it didn’t work either). The LSM is configured through a configuration file “SDNManager.exe.config", which can be found in the LSM’s installation directory: “C:\Program Files\Microsoft Lync Server\Microsoft Lync SDN API\”</p> <p>The configuration is quite simple, the value “submituri” specifies the WLCs IP Address and Port, additionally, the value for “backwardcompatibility” must be set to “true”:</p> <p><code>&lt;appSettings&gt;<br>&nbsp;&nbsp;&nbsp; &lt;add key="submituri" value="<a href="http://172.25.81.105:15120&quot;/">http://172.25.81.105:15120"/</a>&gt;<br>&nbsp;&nbsp;&nbsp; &lt;add key="backwardcompatibility" value="true"/&gt;</code></p> <p>With the LSM configured, we installed the Dialog Listener on the Front End Server. During setup, we are asked for the “submituri” so we don’t even have to edit the config file in this case. Note that the submit URI for the LDL points to the LSM.</p> <p>The configuration file for the LDL can be found here: "C:\Program Files\Microsoft Lync Server\Microsoft Lync SDN API\LyncDialogListener.exe.config"</p> <p><code>&lt;appSettings&gt;<br>&nbsp; &lt;add key="submituri" value="<a href="http://srv01.ccielab.local:9333/LDL/CallInfo&quot;/">http://srv01.ccielab.local:9333/LDL/CallInfo"/</a>&gt;</code></p> <h1>The Client Side</h1> <p>Now we were ready for some testing and connected our clients to the new SSID. After signing into Lync and making some calls, we were able to verify that they appeared in the WLC’s “Monitoring” tab.</p> <p><a href="/assets/image_729.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_727.png" width="244" height="104"></a></p> <p>Using Wireshark, we were able to verify the DSCP values for incoming packets from the WLAN:</p> <p><a href="/assets/image_730.png"><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px; border-top-width: 0px" border="0" alt="image" src="/assets/image_thumb_728.png" width="244" height="39"></a></p> <p>Last but not least, we had a look at the POST requests from the LSM to the WLC. As we are not using https, they are sent in clear-text and can be analyzed using Wireshark’s “Follow TCP stream” feature:</p> <p><code>POST /LDL/CallInfo HTTP/1.1<br>Content-Type: text/xml<br>Accept: text/xml<br>Host: srv01.ccielab.local:9333<br>Content-Length: 2823<br>Expect: 100-continue</p> <p>HTTP/1.1 100 Continue</p> <p>&lt;LyncDiagnostics Version="1.0"&gt;<br>&nbsp; &lt;ConnectionInfo&gt;<br>&nbsp;&nbsp;&nbsp; &lt;FrontEnd&gt;s4b&lt;/FrontEnd&gt;<br>&nbsp;&nbsp;&nbsp; &lt;CallId&gt;8a5ee59e7f24cc47a8a5e5ef5408164b&lt;/CallId&gt;<br>&nbsp;&nbsp;&nbsp; &lt;CSEQ&gt;3&lt;/CSEQ&gt;<br>&nbsp;&nbsp;&nbsp; &lt;ConversationId&gt;AdHItACZ40eYIzsElkmUXxEpJfdLYA==&lt;/ConversationId&gt;<br>&nbsp;&nbsp;&nbsp; &lt;TimeStamp&gt;2016-06-17T16:36:16.0502033Z&lt;/TimeStamp&gt;<br>&nbsp; &lt;/ConnectionInfo&gt;<br>&nbsp; <strong>&lt;StartOrUpdate Type="audio"&gt;<br></strong>&nbsp;&nbsp;&nbsp; &lt;From&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Id&gt;1c36b0157b&lt;/Id&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EPId&gt;591fcf6a94&lt;/EPId&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;URI&gt;sip:9EDEEC6DC6AD3929EF68B672BCC8C2BB@ccielab.local&lt;/URI&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>&lt;IP&gt;172.25.81.237&lt;/IP&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Port&gt;21448&lt;/Port&gt;</strong><br>&nbsp;&nbsp;&nbsp; &lt;/From&gt;<br>&nbsp;&nbsp;&nbsp; &lt;To&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Id&gt;94b8a54712&lt;/Id&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EPId&gt;213808492931&lt;/EPId&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;URI&gt;sip:AA6B09353F1F13116DC23FFDDB2A407F@ccielab.local&lt;/URI&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Contact&gt;sip:AA6B09353F1F13116DC23FFDDB2A407F@ccielab.local;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; opaque=user:epid:vaj8zwoldfc0zkl6hghhoaaa;gruu&lt;/Contact&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <strong>&lt;IP&gt;172.25.81.238&lt;/IP&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Port&gt;11616&lt;/Port&gt;<br></strong>&nbsp;&nbsp;&nbsp; &lt;/To&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Properties&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Protocol&gt;UDP&lt;/Protocol&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="SIREN/16000"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Low&gt;52600&lt;/Low&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;High&gt;68600&lt;/High&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/EstimatedBandwidth&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="PCMU/8000"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Low&gt;97000&lt;/Low&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;High&gt;161000&lt;/High&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/EstimatedBandwidth&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="PCMA/8000"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Low&gt;97000&lt;/Low&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;High&gt;161000&lt;/High&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;/EstimatedBandwidth&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="RED/8000" /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="CN/8000" /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="CN/16000" /&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="telephone-event/8000" /&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/Properties&gt;<br>&nbsp; &lt;/StartOrUpdate&gt;</p> <p>…</p> <p><strong>&lt;StartOrUpdate Type="video"&gt;</strong><br>&nbsp; &lt;From&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Id&gt;94b8a54712&lt;/Id&gt;<br>&nbsp;&nbsp;&nbsp; &lt;EPId&gt;213808492931&lt;/EPId&gt;<br>&nbsp;&nbsp;&nbsp; &lt;URI&gt;sip:AA6B09353F1F13116DC23FFDDB2A407F@ccielab.local&lt;/URI&gt;<br><strong>&nbsp;&nbsp;&nbsp; &lt;IP&gt;172.25.81.238&lt;/IP&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Port&gt;15150&lt;/Port&gt;</strong><br>&nbsp; &lt;/From&gt;<br>&nbsp; &lt;To&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Id&gt;1c36b0157b&lt;/Id&gt;<br>&nbsp;&nbsp;&nbsp; &lt;EPId&gt;591fcf6a94&lt;/EPId&gt;<br>&nbsp;&nbsp;&nbsp; &lt;URI&gt;sip:9EDEEC6DC6AD3929EF68B672BCC8C2BB@ccielab.local&lt;/URI&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Contact&gt;sip:9EDEEC6DC6AD3929EF68B672BCC8C2BB@ccielab.local;<br>&nbsp;&nbsp;&nbsp; opaque=user:epid:a_6tcapa01gtycf5ts8qnqaa;gruu&lt;/Contact&gt;<br><strong>&nbsp;&nbsp;&nbsp; &lt;IP&gt;172.25.81.237&lt;/IP&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Port&gt;6490&lt;/Port&gt;</strong><br>&nbsp; &lt;/To&gt;<br>&nbsp; &lt;Properties&gt;<br>&nbsp;&nbsp;&nbsp; &lt;Protocol&gt;UDP&lt;/Protocol&gt;<br>&nbsp;&nbsp;&nbsp; &lt;EstimatedBandwidth Codec="x-rtvc1/90000"&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;Low&gt;460000&lt;/Low&gt;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &lt;High&gt;2510000&lt;/High&gt;<br>&nbsp;&nbsp;&nbsp; &lt;/EstimatedBandwidth&gt;<br>&nbsp; &lt;/Properties&gt;<br>&lt;/StartOrUpdate&gt;</code></p> <p>As you can see, the LSM uses simple http POST requests to send information to a network controller. The network controller just has to “listen” for such data and act on it.</p> <p>This concludes our journey into the wireless network for today, hope you enjoyed it as much as I did :)</p> <p>&nbsp;</p> <p>Many thanks to my colleague and fellow call-quality-optimizer KD!</p> <p>&nbsp;</p> <p>Cheers,<br>Tom</p>
